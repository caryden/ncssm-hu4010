---
---

<div id="user-buyer" class="visualization"></div>

<script is:inline>
(function() {
    const containerId = 'user-buyer';

    function draw() {
        if (!window.Visualization || !d3) return;
        const viz = window.Visualization.create(containerId, { padding: 0.05 });
        if (!viz) return;

        const { svg, bounds } = viz;

        // Proportional calculations based on container
        const contextX = bounds.left + bounds.width * 0.12;
        const userBoxX = bounds.left + bounds.width * 0.27;
        const equalSignX = bounds.centerX;
        const buyerBoxX = bounds.left + bounds.width * 0.57;
        const boxWidth = bounds.width * 0.15;
        const boxHeight = bounds.height * 0.12;
        const rowSpacing = bounds.height * 0.28;
        const headerY = bounds.top + bounds.height * 0.08;

        // Headers
        svg.append('text')
            .attr('x', userBoxX + boxWidth/2)
            .attr('y', headerY)
            .attr('text-anchor', 'middle')
            .attr('fill', '#4a7ab8')
            .attr('font-family', 'Montserrat, sans-serif')
            .attr('font-size', '1.25rem')
            .attr('font-weight', '600')
            .text('End User')
            .attr('opacity', 0)
            .transition()
            .delay(300)
            .duration(500)
            .attr('opacity', 1);

        svg.append('text')
            .attr('x', buyerBoxX + boxWidth/2)
            .attr('y', headerY)
            .attr('text-anchor', 'middle')
            .attr('fill', '#d4a028')
            .attr('font-family', 'Montserrat, sans-serif')
            .attr('font-size', '1.25rem')
            .attr('font-weight', '600')
            .text('Economic Buyer')
            .attr('opacity', 0)
            .transition()
            .delay(300)
            .duration(500)
            .attr('opacity', 1);

        const scenarios = [
            { label: 'Video Games', user: 'Teenager', buyer: 'Parent' },
            { label: 'Enterprise Soft', user: 'Employee', buyer: 'CTO / Manager' },
            { label: 'Dog Food', user: 'Dog', buyer: 'Owner' }
        ];

        scenarios.forEach((s, i) => {
            const y = headerY + bounds.height * 0.15 + i * rowSpacing;

            // Scenario label
            svg.append('text')
                .attr('x', contextX)
                .attr('y', y + boxHeight/2)
                .attr('text-anchor', 'end')
                .attr('dominant-baseline', 'middle')
                .attr('fill', '#a0a0a0')
                .attr('font-family', 'Montserrat, sans-serif')
                .attr('font-size', '1rem')
                .text(s.label)
                .attr('opacity', 0)
                .transition()
                .delay(600 + i * 200)
                .duration(400)
                .attr('opacity', 1);

            // User box
            svg.append('rect')
                .attr('x', userBoxX)
                .attr('y', y)
                .attr('width', boxWidth)
                .attr('height', boxHeight)
                .attr('rx', 8)
                .attr('fill', '#1a2634')
                .attr('stroke', '#4a7ab8')
                .attr('stroke-width', 2)
                .attr('opacity', 0)
                .transition()
                .delay(900 + i * 200)
                .duration(400)
                .attr('opacity', 1);

            svg.append('text')
                .attr('x', userBoxX + boxWidth/2)
                .attr('y', y + boxHeight/2)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('fill', '#fff')
                .attr('font-family', 'Montserrat, sans-serif')
                .attr('font-size', '1rem')
                .text(s.user)
                .attr('opacity', 0)
                .transition()
                .delay(1100 + i * 200)
                .duration(400)
                .attr('opacity', 1);

            // Not Equal Sign
            svg.append('text')
                .attr('x', equalSignX)
                .attr('y', y + boxHeight/2)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('fill', '#ef4444')
                .attr('font-size', '1.5rem')
                .attr('font-weight', 'bold')
                .text('â‰ ')
                .attr('opacity', 0)
                .transition()
                .delay(1200 + i * 200)
                .duration(400)
                .attr('opacity', 1);

            // Buyer box
            svg.append('rect')
                .attr('x', buyerBoxX)
                .attr('y', y)
                .attr('width', boxWidth)
                .attr('height', boxHeight)
                .attr('rx', 8)
                .attr('fill', '#2a261a')
                .attr('stroke', '#d4a028')
                .attr('stroke-width', 2)
                .attr('opacity', 0)
                .transition()
                .delay(1400 + i * 200)
                .duration(400)
                .attr('opacity', 1);

            svg.append('text')
                .attr('x', buyerBoxX + boxWidth/2)
                .attr('y', y + boxHeight/2)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('fill', '#fff')
                .attr('font-family', 'Montserrat, sans-serif')
                .attr('font-size', '1rem')
                .text(s.buyer)
                .attr('opacity', 0)
                .transition()
                .delay(1600 + i * 200)
                .duration(400)
                .attr('opacity', 1);
        });
    }

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                setTimeout(draw, 300);
                observer.disconnect();
            }
        });
    });

    const el = document.getElementById(containerId);
    if (el) observer.observe(el);
})();
</script>

<style>
    .visualization {
        width: 100%;
        height: 100%;
        min-height: 500px;
    }
</style>
