<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Class 7: Will You Make Money? | Applications in Entrepreneurship</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../shared/styles.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* Theme 4: How Do You Make Money? - Amber */
    :root {
      --theme-color: #f59e0b;
      --theme-color-dim: #d4a028;
      --theme-amber-light: #fbbf24;
      --gradient-hero: linear-gradient(135deg, #d4a028 0%, #f59e0b 100%);
      --gradient-text: linear-gradient(135deg, #ffffff 0%, #f59e0b 100%);
    }

    /* Metrics Grid */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
      max-width: 800px;
      margin: 40px auto;
    }

    .metric-card {
      background: var(--bg-secondary);
      border: 1px solid var(--dark-border, #1e1e2e);
      border-radius: 16px;
      padding: 30px;
      text-align: center;
      opacity: 0;
      transform: scale(0.9);
      transition: all 0.5s ease;
    }

    .slide.active .metric-card {
      animation: metricFadeIn 500ms ease forwards;
    }

    .slide.active .metric-card:nth-child(1) { animation-delay: 150ms; }
    .slide.active .metric-card:nth-child(2) { animation-delay: 300ms; }
    .slide.active .metric-card:nth-child(3) { animation-delay: 450ms; }
    .slide.active .metric-card:nth-child(4) { animation-delay: 600ms; }

    @keyframes metricFadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .metric-card.danger {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }

    .metric-card .value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--theme-color);
      margin-bottom: 10px;
      font-family: var(--font-display);
    }

    .metric-card.danger .value {
      color: var(--danger);
    }

    .metric-card .label {
      font-size: 1.1rem;
      color: var(--text-secondary);
    }

    /* Formula Display */
    .formula-display {
      background: var(--bg-secondary);
      border: 2px solid var(--theme-color);
      border-radius: 20px;
      padding: 50px 80px;
      text-align: center;
      max-width: 800px;
      margin: 40px auto;
    }

    .formula-display .formula {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: Georgia, serif;
    }

    .formula-display .formula span {
      color: var(--theme-color);
    }

    /* Calculation Steps */
    .calculation-steps {
      max-width: 700px;
      margin: 0 auto;
    }

    .calc-step {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 30px;
      background: var(--bg-secondary);
      border-radius: 12px;
      margin-bottom: 15px;
      opacity: 0;
      transform: translateX(-30px);
    }

    .slide.active .calc-step {
      animation: calcFadeIn 500ms ease forwards;
    }

    .slide.active .calc-step:nth-child(1) { animation-delay: 200ms; }
    .slide.active .calc-step:nth-child(2) { animation-delay: 400ms; }
    .slide.active .calc-step:nth-child(3) { animation-delay: 600ms; }
    .slide.active .calc-step:nth-child(4) { animation-delay: 800ms; }
    .slide.active .calc-step:nth-child(5) { animation-delay: 1000ms; }

    @keyframes calcFadeIn {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .calc-step .label {
      font-size: 1.3rem;
      color: var(--text-secondary);
    }

    .calc-step .value {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--theme-color);
      font-family: var(--font-mono);
    }

    .calc-step.result {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, transparent 100%);
      border: 2px solid var(--theme-color);
    }

    .calc-step.result .value {
      font-size: 2rem;
    }

    /* Retention Bars */
    .retention-bars {
      display: flex;
      flex-direction: column;
      gap: 30px;
      max-width: 800px;
      margin: 40px auto;
    }

    .retention-row {
      display: grid;
      grid-template-columns: 120px 1fr 100px;
      align-items: center;
      gap: 20px;
    }

    .retention-label {
      font-size: 1rem;
      color: var(--text-secondary);
    }

    .retention-bar-container {
      height: 50px;
      background: var(--bg-secondary);
      border-radius: 8px;
      overflow: hidden;
    }

    .retention-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--theme-color), var(--theme-amber-light));
      border-radius: 8px;
      width: 0;
      transition: width 1.5s ease-out;
    }

    .retention-value {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--theme-color);
      font-family: var(--font-mono);
    }

    /* Costs Table */
    .costs-table {
      width: 100%;
      max-width: 600px;
      margin: 30px auto;
      border-collapse: collapse;
    }

    .costs-table th,
    .costs-table td {
      padding: 15px 25px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .costs-table th {
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 1rem;
    }

    .costs-table td {
      font-size: 1.2rem;
    }

    .costs-table td:last-child {
      text-align: right;
      font-family: var(--font-mono);
      color: var(--theme-color);
    }

    .costs-table tr.total {
      border-top: 2px solid var(--theme-color);
    }

    .costs-table tr.total td {
      font-weight: 700;
      font-size: 1.4rem;
    }

    /* Levers Grid */
    .levers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 50px;
      max-width: 1000px;
      margin: 30px auto;
    }

    .lever-column {
      background: var(--bg-secondary);
      border-radius: 20px;
      padding: 30px;
    }

    .lever-column h3 {
      font-size: 1.5rem;
      margin-bottom: 25px;
      color: var(--success);
      text-align: center;
      font-family: var(--font-display);
    }

    .lever-column.decrease h3 {
      color: var(--theme-color);
    }

    .lever-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.02);
      opacity: 0;
      transform: translateY(10px);
    }

    .slide.active .lever-item {
      animation: leverFadeIn 400ms ease forwards;
    }

    .slide.active .lever-column:first-child .lever-item:nth-child(1) { animation-delay: 200ms; }
    .slide.active .lever-column:first-child .lever-item:nth-child(2) { animation-delay: 300ms; }
    .slide.active .lever-column:first-child .lever-item:nth-child(3) { animation-delay: 400ms; }
    .slide.active .lever-column:first-child .lever-item:nth-child(4) { animation-delay: 500ms; }
    .slide.active .lever-column:last-child .lever-item:nth-child(1) { animation-delay: 600ms; }
    .slide.active .lever-column:last-child .lever-item:nth-child(2) { animation-delay: 700ms; }
    .slide.active .lever-column:last-child .lever-item:nth-child(3) { animation-delay: 800ms; }
    .slide.active .lever-column:last-child .lever-item:nth-child(4) { animation-delay: 900ms; }

    @keyframes leverFadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .lever-item .icon {
      font-size: 1.5rem;
    }

    .lever-item .text {
      font-size: 1.1rem;
    }

    /* Comparison Grid for Zoom vs WeWork */
    .comparison-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      flex: 1;
      align-items: start;
      max-width: 1000px;
      margin: 30px auto;
    }

    .comparison-side {
      padding: 40px;
      border-radius: 20px;
      height: 100%;
    }

    .comparison-side.left {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, transparent 100%);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .comparison-side.right {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .comparison-side h3 {
      font-size: 1.8rem;
      margin-bottom: 30px;
      font-family: var(--font-display);
    }

    .comparison-side.left h3 {
      color: var(--danger);
    }

    .comparison-side.right h3 {
      color: var(--success);
    }

    .comparison-side ul {
      list-style: none;
    }

    .comparison-side li {
      font-size: 1.2rem;
      margin-bottom: 20px;
      padding-left: 30px;
      position: relative;
      color: var(--text-secondary);
    }

    .comparison-side li::before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      color: var(--theme-color);
    }

    /* Funnel Container */
    #funnel-viz {
      width: 100%;
      height: 400px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Gauge Container */
    #ratio-gauge {
      width: 100%;
      height: 350px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Includes grid */
    .includes-list {
      margin-top: 30px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      max-width: 600px;
    }

    .include-item {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.2rem;
      color: var(--text-secondary);
    }

    .include-item .icon {
      color: var(--theme-color);
    }

    /* Homework items */
    .homework-item {
      display: flex;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 25px;
    }

    .homework-icon {
      font-size: 1.5rem;
      width: 40px;
    }

    .homework-text {
      font-size: 1.3rem;
      color: var(--text-secondary);
      flex: 1;
    }

    /* Section label */
    .section-label {
      font-size: 1.2rem;
      color: var(--text-secondary);
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 3px;
    }

    /* Emphasis text */
    .emphasis {
      color: var(--theme-color);
      font-weight: 600;
    }

    /* Pulse animation for ratio formula */
    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    /* Collapse styling */
    .collapse-result {
      text-align: center;
      margin-top: 40px;
    }

    .collapse-result .before-after {
      font-size: 4rem;
      margin-bottom: 40px;
    }

    .collapse-result .strike {
      color: var(--text-secondary);
      text-decoration: line-through;
    }

    .collapse-result .final {
      color: var(--danger);
      font-weight: 700;
    }

    .collapse-icons {
      display: flex;
      justify-content: center;
      gap: 60px;
      margin-top: 50px;
    }

    .collapse-icon {
      text-align: center;
    }

    .collapse-icon .emoji {
      font-size: 3rem;
      margin-bottom: 10px;
    }

    .collapse-icon .text {
      color: var(--danger);
    }

    /* Components split */
    .components-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 50px;
      max-width: 900px;
      margin: 40px auto;
    }

    .component-box {
      background: var(--bg-secondary);
      padding: 30px;
      border-radius: 16px;
    }

    .component-box h3 {
      color: var(--theme-color);
      margin-bottom: 25px;
      font-size: 1.4rem;
      font-family: var(--font-display);
    }

    .component-box ul {
      list-style: none;
    }

    .component-box li {
      margin-bottom: 15px;
      color: var(--text-secondary);
      padding-left: 20px;
      position: relative;
    }

    .component-box li::before {
      content: '‚ñ∏';
      position: absolute;
      left: 0;
      color: var(--theme-color);
    }

    /* Appendix specific styles */
    .ltv-breakdown {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      max-width: 900px;
      margin: 1.5rem auto;
    }

    .ltv-factor {
      background: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
    }

    .ltv-factor h4 {
      color: var(--theme-color);
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      font-family: var(--font-display);
    }

    .ltv-factor .range {
      font-family: var(--font-mono);
      font-size: 1.5rem;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .ltv-factor p {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .benchmark-table {
      width: 100%;
      max-width: 800px;
      margin: 1.5rem auto;
      border-collapse: collapse;
    }

    .benchmark-table th,
    .benchmark-table td {
      padding: 12px 20px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .benchmark-table th {
      color: var(--theme-color);
      font-weight: 600;
      font-family: var(--font-display);
    }

    .benchmark-table td {
      color: var(--text-secondary);
    }

    .benchmark-table td:not(:first-child) {
      font-family: var(--font-mono);
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Overlay Backdrop -->
  <div class="overlay-backdrop" id="overlay-backdrop"></div>

  <!-- Table of Contents Overlay -->
  <div class="toc-overlay" id="toc-overlay">
    <div class="toc-header">
      <h2>Table of Contents</h2>
      <button class="toc-close" id="toc-close">&times;</button>
    </div>
    <div class="toc-content" id="toc-content"></div>
  </div>

  <!-- Appendix Overlay -->
  <div class="appendix-overlay" id="appendix-overlay">
    <div class="appendix-header">
      <h2>Appendix</h2>
      <button class="appendix-close" id="appendix-close">&times;</button>
    </div>
    <div class="appendix-content" id="appendix-content"></div>
  </div>

  <div class="presentation">
    <!-- TITLE SLIDE -->
    <div class="slide slide-title active" data-slide="1" data-section="opening" data-title="Title">
      <div class="slide-content">
        <h1>Will You Make Money?</h1>
        <p class="subtitle">LTV, COCA & The Crucial Ratio</p>
        <p class="session-info">Class 7 | DE Steps 17, 18, 19</p>
      </div>
    </div>

    <!-- OPENING: THE REALITY -->
    <div class="slide" data-slide="2" data-section="opening" data-title="The Reality">
      <div class="slide-content" style="text-align: center;">
        <p class="statement" style="color: var(--theme-color);">A business isn't viable if it costs more to get a customer than that customer is worth.</p>
      </div>
    </div>

    <!-- WEWORK STORY -->
    <div class="slide slide-visual" data-slide="3" data-section="story" data-title="WeWork 2019">
      <div class="slide-content">
        <h2>2019: WeWork Was Unstoppable</h2>
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="value">$47B</div>
            <div class="label">Valuation</div>
          </div>
          <div class="metric-card">
            <div class="value">Exponential</div>
            <div class="label">Growth</div>
          </div>
          <div class="metric-card">
            <div class="value">700+</div>
            <div class="label">Locations</div>
          </div>
          <div class="metric-card">
            <div class="value">Glowing</div>
            <div class="label">Press Coverage</div>
          </div>
        </div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="4" data-section="story" data-title="WeWork Reality">
      <div class="slide-content">
        <h2>Then Investors Looked at Unit Economics</h2>
        <div class="metrics-grid">
          <div class="metric-card danger">
            <div class="value">$millions</div>
            <div class="label">Cost per location</div>
          </div>
          <div class="metric-card danger">
            <div class="value">5+ years</div>
            <div class="label">Time to profit</div>
          </div>
          <div class="metric-card danger">
            <div class="value">Too High</div>
            <div class="label">Churn rate</div>
          </div>
          <div class="metric-card danger">
            <div class="value">Negative</div>
            <div class="label">LTV/COCA Ratio</div>
          </div>
        </div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="5" data-section="story" data-title="WeWork Collapse">
      <div class="slide-content">
        <h2>The Collapse</h2>
        <div class="collapse-result">
          <div class="before-after">
            <span class="strike">$47B</span>
            <span style="color: var(--text-secondary); margin: 0 30px;">‚Üí</span>
            <span class="final">$9B</span>
          </div>
          <div class="collapse-icons">
            <div class="collapse-icon">
              <div class="emoji">üëî</div>
              <div class="text">CEO Fired</div>
            </div>
            <div class="collapse-icon">
              <div class="emoji">üìâ</div>
              <div class="text">IPO Cancelled</div>
            </div>
          </div>
          <p style="margin-top: 60px; font-size: 1.5rem; color: var(--theme-color);">"Growth means nothing without unit economics"</p>
        </div>
      </div>
    </div>

    <div class="slide slide-list" data-slide="6" data-section="story" data-title="Tonight's Mission">
      <div class="slide-content">
        <h2>Tonight We'll Calculate</h2>
        <ul>
          <li><strong>LTV:</strong> How much is a customer worth?</li>
          <li><strong>COCA:</strong> How much does it cost to get one?</li>
          <li><strong>The Ratio:</strong> Is this business viable?</li>
        </ul>
      </div>
    </div>

    <!-- STEP 17: LTV -->
    <div class="slide" data-slide="7" data-section="step17" data-title="Step 17 Intro">
      <div class="slide-content" style="text-align: center;">
        <p class="section-label">Step 17</p>
        <p class="statement">Calculate Lifetime Value (LTV)</p>
      </div>
    </div>

    <div class="slide slide-two-part" data-slide="8" data-section="step17" data-title="What is LTV">
      <div class="slide-content">
        <p class="primary">Customer Lifetime Value</p>
        <p class="secondary">The total <span class="emphasis">profit</span> from an average customer over your entire relationship with them.</p>
        <div style="display: flex; justify-content: center; align-items: center; margin-top: 60px; gap: 30px;">
          <div style="font-size: 4rem;">üë§</div>
          <div style="font-size: 2rem; color: var(--text-secondary);">‚Üí</div>
          <div style="display: flex; gap: 10px;">
            <span style="font-size: 2rem;">üíµ</span>
            <span style="font-size: 2rem;">üíµ</span>
            <span style="font-size: 2rem;">üíµ</span>
            <span style="font-size: 2rem;">üíµ</span>
            <span style="font-size: 2rem;">üíµ</span>
          </div>
        </div>
        <p class="tertiary" style="margin-top: 40px;">Not revenue‚Äîprofit. After your costs to serve them.</p>
      </div>
    </div>

    <div class="slide slide-list" data-slide="9" data-section="step17" data-title="Why LTV Matters">
      <div class="slide-content">
        <h2>LTV Tells You...</h2>
        <ul>
          <li>How much you can <strong>afford</strong> to spend acquiring customers</li>
          <li>Whether customers are <strong>valuable enough</strong> to sustain a business</li>
          <li>Why <strong>retention</strong> is so important</li>
        </ul>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="10" data-section="step17" data-title="LTV Formula">
      <div class="slide-content">
        <h2>The LTV Formula</h2>
        <div class="formula-display" style="margin-top: 60px;">
          <p class="formula"><span>LTV</span> = (ARPU √ó Gross Margin) √ó Lifespan</p>
        </div>
        <div style="display: flex; justify-content: center; gap: 80px; margin-top: 60px;">
          <div style="text-align: center;">
            <div style="font-size: 1.5rem; color: var(--theme-color); margin-bottom: 10px; font-family: var(--font-display);">ARPU</div>
            <div style="color: var(--text-secondary);">Avg Revenue<br>Per User</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 1.5rem; color: var(--theme-color); margin-bottom: 10px; font-family: var(--font-display);">Margin</div>
            <div style="color: var(--text-secondary);">Revenue<br>minus costs</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 1.5rem; color: var(--theme-color); margin-bottom: 10px; font-family: var(--font-display);">Lifespan</div>
            <div style="color: var(--text-secondary);">Months as<br>customer</div>
          </div>
        </div>
      </div>
    </div>

    <div class="slide slide-two-part" data-slide="11" data-section="step17" data-title="ARPU">
      <div class="slide-content">
        <p class="primary">ARPU: Average Revenue Per User</p>
        <p class="secondary">What does the average customer pay per month/year?</p>
        <div class="includes-list" style="margin-top: 40px;">
          <div class="include-item"><span class="icon">üí≥</span> Base subscription/purchase</div>
          <div class="include-item"><span class="icon">‚¨ÜÔ∏è</span> Upsells and add-ons</div>
          <div class="include-item"><span class="icon">üìà</span> Expansion revenue</div>
          <div class="include-item"><span class="icon">üîÑ</span> Recurring purchases</div>
        </div>
        <p class="tertiary" style="margin-top: 40px;">Use realistic averages, not best-case scenarios</p>
      </div>
    </div>

    <div class="slide slide-two-part" data-slide="12" data-section="step17" data-title="Gross Margin">
      <div class="slide-content">
        <p class="primary">Gross Margin</p>
        <p class="secondary">Revenue minus direct costs to serve each customer</p>
        <div class="includes-list" style="max-width: 700px; margin-top: 40px;">
          <div class="include-item"><span class="icon">üñ•Ô∏è</span> Hosting/infrastructure</div>
          <div class="include-item"><span class="icon">üéß</span> Customer support</div>
          <div class="include-item"><span class="icon">üí≥</span> Payment processing (2-3%)</div>
          <div class="include-item"><span class="icon">üì¶</span> COGS (physical goods)</div>
        </div>
        <div style="margin-top: 50px; padding: 20px 30px; background: var(--bg-secondary); border-radius: 12px; display: inline-block;">
          <span style="color: var(--text-secondary);">Typical:</span>
          <span style="color: var(--theme-color); margin-left: 15px; font-weight: 600;">60-80% for SaaS</span>
          <span style="color: var(--text-secondary); margin: 0 15px;">|</span>
          <span style="color: var(--theme-color); font-weight: 600;">Lower for physical products</span>
        </div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="13" data-section="step17" data-title="Lifespan">
      <div class="slide-content">
        <h2>Customer Lifespan</h2>
        <div style="display: flex; justify-content: center; align-items: center; gap: 40px; margin: 50px 0;">
          <div style="text-align: center; padding: 30px; background: var(--bg-secondary); border-radius: 16px;">
            <div style="font-size: 2rem; margin-bottom: 10px;">üéâ</div>
            <div style="color: var(--success);">Customer<br>Acquired</div>
          </div>
          <div style="font-size: 2rem; color: var(--text-secondary);">‚Üí ‚Üí ‚Üí</div>
          <div style="text-align: center; padding: 30px; background: var(--bg-secondary); border-radius: 16px; width: 200px;">
            <div style="font-size: 2rem; margin-bottom: 10px;">üìÖ</div>
            <div style="color: var(--theme-color);">Months of<br>Usage</div>
          </div>
          <div style="font-size: 2rem; color: var(--text-secondary);">‚Üí ‚Üí ‚Üí</div>
          <div style="text-align: center; padding: 30px; background: var(--bg-secondary); border-radius: 16px;">
            <div style="font-size: 2rem; margin-bottom: 10px;">üëã</div>
            <div style="color: var(--danger);">Customer<br>Churns</div>
          </div>
        </div>
        <div class="formula-display" style="max-width: 500px;">
          <p class="formula" style="font-size: 1.8rem;"><span>Lifespan</span> = 1 √∑ Monthly Churn Rate</p>
        </div>
        <p style="text-align: center; margin-top: 30px; color: var(--text-secondary); font-size: 1.2rem;">
          Example: 5% monthly churn = <span style="color: var(--theme-color);">20 month</span> lifespan
        </p>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="14" data-section="step17" data-title="Power of Retention">
      <div class="slide-content">
        <h2>Small Churn Changes = Huge LTV Changes</h2>
        <p style="text-align: center; color: var(--text-secondary); margin-bottom: 20px;">At $50 ARPU, 70% margin</p>
        <div class="retention-bars">
          <div class="retention-row">
            <div class="retention-label">10%/mo churn<br>10 mo lifespan</div>
            <div class="retention-bar-container">
              <div class="retention-bar" data-width="20"></div>
            </div>
            <div class="retention-value">$350</div>
          </div>
          <div class="retention-row">
            <div class="retention-label">5%/mo churn<br>20 mo lifespan</div>
            <div class="retention-bar-container">
              <div class="retention-bar" data-width="40"></div>
            </div>
            <div class="retention-value">$700</div>
          </div>
          <div class="retention-row">
            <div class="retention-label">2%/mo churn<br>50 mo lifespan</div>
            <div class="retention-bar-container">
              <div class="retention-bar" data-width="100"></div>
            </div>
            <div class="retention-value">$1,750</div>
          </div>
        </div>
        <p style="text-align: center; margin-top: 40px; font-size: 1.8rem; color: var(--theme-color); font-weight: 600;">Retention is everything.</p>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="15" data-section="step17" data-title="LTV Example">
      <div class="slide-content">
        <h2>Example LTV Calculation</h2>
        <div class="calculation-steps">
          <div class="calc-step">
            <span class="label">ARPU (monthly)</span>
            <span class="value">$50</span>
          </div>
          <div class="calc-step">
            <span class="label">Gross Margin</span>
            <span class="value">70%</span>
          </div>
          <div class="calc-step">
            <span class="label">Monthly Churn</span>
            <span class="value">5%</span>
          </div>
          <div class="calc-step">
            <span class="label">Lifespan (1 √∑ 0.05)</span>
            <span class="value">20 months</span>
          </div>
          <div class="calc-step result">
            <span class="label">LTV = $50 √ó 0.70 √ó 20</span>
            <span class="value">$700</span>
          </div>
        </div>
      </div>
    </div>

    <div class="slide" data-slide="16" data-section="step17" data-title="LTV Workshop">
      <div class="slide-content" style="text-align: center;">
        <p class="statement">Calculate YOUR LTV</p>
        <p class="secondary" style="margin-top: 30px;">15 minutes: ARPU, Margin, Lifespan, LTV</p>
      </div>
    </div>

    <!-- STEPS 18-19: SALES & COCA -->
    <div class="slide" data-slide="17" data-section="step18-19" data-title="Steps 18-19 Intro">
      <div class="slide-content" style="text-align: center;">
        <p class="section-label">Steps 18-19</p>
        <p class="statement">Sales Process & COCA</p>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="18" data-section="step18-19" data-title="Sales Funnel">
      <div class="slide-content">
        <h2>Understanding Your Sales Process</h2>
        <div id="funnel-viz"></div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="19" data-section="step18-19" data-title="Funnel Math">
      <div class="slide-content">
        <h2>Working Backwards</h2>
        <div style="max-width: 600px; margin: 0 auto; text-align: center;">
          <div class="calc-step" style="opacity: 1; transform: none; margin-bottom: 30px;">
            <span class="label">Goal: Customers/month</span>
            <span class="value">20</span>
          </div>
          <div style="font-size: 2rem; color: var(--text-secondary); margin: 20px 0;">‚Üë</div>
          <div class="calc-step" style="opacity: 1; transform: none; margin-bottom: 30px;">
            <span class="label">Close rate (6% of leads)</span>
            <span class="value">6%</span>
          </div>
          <div style="font-size: 2rem; color: var(--text-secondary); margin: 20px 0;">‚Üë</div>
          <div class="calc-step result" style="opacity: 1; transform: none;">
            <span class="label">Leads needed per month</span>
            <span class="value">333</span>
          </div>
        </div>
        <p style="text-align: center; margin-top: 40px; font-size: 1.3rem; color: var(--theme-color);">This tells you what marketing must deliver.</p>
      </div>
    </div>

    <div class="slide slide-two-part" data-slide="20" data-section="step18-19" data-title="What is COCA">
      <div class="slide-content">
        <p class="primary">COCA: Cost of Customer Acquisition</p>
        <p class="secondary">Total cost to acquire one new paying customer</p>
        <div class="formula-display" style="margin-top: 50px; max-width: 700px;">
          <p class="formula" style="font-size: 1.6rem;"><span>COCA</span> = (Marketing + Sales Costs) √∑ Customers Acquired</p>
        </div>
        <div style="display: flex; justify-content: center; align-items: center; gap: 40px; margin-top: 50px;">
          <div style="font-size: 4rem;">üí∞</div>
          <div style="font-size: 2rem; color: var(--text-secondary);">‚Üí</div>
          <div style="font-size: 4rem;">üë§</div>
        </div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="21" data-section="step18-19" data-title="COCA Components">
      <div class="slide-content">
        <h2>What Goes Into COCA?</h2>
        <div class="components-grid">
          <div class="component-box">
            <h3>üì£ Marketing</h3>
            <ul>
              <li>Paid ads</li>
              <li>Content creation</li>
              <li>Events & sponsorships</li>
              <li>Marketing tools</li>
              <li>Marketing salaries</li>
            </ul>
          </div>
          <div class="component-box">
            <h3>ü§ù Sales</h3>
            <ul>
              <li>Sales salaries</li>
              <li>Commissions</li>
              <li>Travel & meetings</li>
              <li>CRM & tools</li>
              <li>Sales enablement</li>
            </ul>
          </div>
        </div>
        <p style="text-align: center; color: var(--warning, #eab308); font-size: 1.2rem; margin-top: 20px;">‚ö†Ô∏è Don't forget founder time!</p>
      </div>
    </div>

    <div class="slide slide-two-part" data-slide="22" data-section="step18-19" data-title="Founder Time">
      <div class="slide-content">
        <p class="primary">Include Your Time</p>
        <p class="secondary">If you spend 20 hours/week selling, that has a cost</p>
        <div class="calculation-steps" style="margin-top: 50px; max-width: 500px;">
          <div class="calc-step" style="opacity: 1; transform: none;">
            <span class="label">Weekly hours selling</span>
            <span class="value">20 hrs</span>
          </div>
          <div class="calc-step" style="opacity: 1; transform: none;">
            <span class="label">√ó Opportunity cost</span>
            <span class="value">$100/hr</span>
          </div>
          <div class="calc-step" style="opacity: 1; transform: none;">
            <span class="label">= Weekly cost</span>
            <span class="value">$2,000</span>
          </div>
          <div class="calc-step result" style="opacity: 1; transform: none;">
            <span class="label">Monthly founder sales cost</span>
            <span class="value">$8,000</span>
          </div>
        </div>
        <p class="tertiary" style="margin-top: 30px;">Most founders undercount this</p>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="23" data-section="step18-19" data-title="COCA Example">
      <div class="slide-content">
        <h2>Example COCA Calculation</h2>
        <table class="costs-table">
          <thead>
            <tr>
              <th>Category</th>
              <th>Monthly Cost</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Paid ads</td>
              <td>$3,000</td>
            </tr>
            <tr>
              <td>Content creation</td>
              <td>$1,000</td>
            </tr>
            <tr>
              <td>Founder time</td>
              <td>$4,000</td>
            </tr>
            <tr>
              <td>Tools & software</td>
              <td>$500</td>
            </tr>
            <tr class="total">
              <td>Total</td>
              <td>$8,500</td>
            </tr>
          </tbody>
        </table>
        <div style="text-align: center; margin-top: 30px;">
          <p style="color: var(--text-secondary); font-size: 1.2rem;">√∑ 10 customers/month</p>
          <p style="font-size: 2.5rem; color: var(--theme-color); font-weight: 700; margin-top: 20px; font-family: var(--font-mono);">COCA = $850</p>
        </div>
      </div>
    </div>

    <div class="slide" data-slide="24" data-section="step18-19" data-title="COCA Workshop">
      <div class="slide-content" style="text-align: center;">
        <p class="statement">Calculate YOUR COCA</p>
        <p class="secondary" style="margin-top: 30px;">10 minutes: All costs, customer projection, COCA</p>
      </div>
    </div>

    <!-- THE RATIO -->
    <div class="slide slide-visual" data-slide="25" data-section="ratio" data-title="The Ratio">
      <div class="slide-content">
        <h2>The Moment of Truth</h2>
        <div class="formula-display pulse" style="margin-top: 80px;">
          <p class="formula" style="font-size: 3.5rem;"><span>LTV</span> √∑ <span>COCA</span> > 3</p>
        </div>
        <p style="text-align: center; margin-top: 50px; font-size: 1.5rem; color: var(--text-secondary);">
          Your LTV should be <span style="color: var(--theme-color); font-weight: 700;">at least 3x</span> your COCA
        </p>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="26" data-section="ratio" data-title="Interpreting Ratio">
      <div class="slide-content">
        <h2>Interpreting Your Ratio</h2>
        <div id="ratio-gauge"></div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="27" data-section="ratio" data-title="Fixing Bad Ratio">
      <div class="slide-content">
        <h2>If Your Ratio Is Bad... You Have Options</h2>
        <div class="levers-grid">
          <div class="lever-column">
            <h3>‚¨ÜÔ∏è Increase LTV</h3>
            <div class="lever-item"><span class="icon">üíµ</span><span class="text">Raise prices</span></div>
            <div class="lever-item"><span class="icon">üîí</span><span class="text">Reduce churn</span></div>
            <div class="lever-item"><span class="icon">‚ûï</span><span class="text">Add upsells</span></div>
            <div class="lever-item"><span class="icon">‚úÇÔ∏è</span><span class="text">Cut serving costs</span></div>
          </div>
          <div class="lever-column decrease">
            <h3>‚¨áÔ∏è Decrease COCA</h3>
            <div class="lever-item"><span class="icon">üì¢</span><span class="text">Cheaper channels</span></div>
            <div class="lever-item"><span class="icon">üìà</span><span class="text">Better conversion</span></div>
            <div class="lever-item"><span class="icon">üó£Ô∏è</span><span class="text">Referrals/virality</span></div>
            <div class="lever-item"><span class="icon">‚ö°</span><span class="text">Shorter sales cycle</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="28" data-section="ratio" data-title="Retention Lever">
      <div class="slide-content">
        <h2>Retention is Usually the Biggest Lever</h2>
        <div style="max-width: 700px; margin: 60px auto; text-align: center;">
          <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, transparent 100%); border: 1px solid rgba(16, 185, 129, 0.3); padding: 40px; border-radius: 20px; margin-bottom: 40px;">
            <p style="font-size: 1.5rem; color: var(--text-secondary); margin-bottom: 20px;">Cutting churn from 5% to 3%</p>
            <p style="font-size: 3rem; font-weight: 700; color: var(--success);">LTV increases 67%</p>
          </div>
          <p style="color: var(--text-secondary); font-size: 1.3rem;">Same effort on other levers = smaller impact</p>
          <p style="color: var(--theme-color); font-size: 1.8rem; font-weight: 600; margin-top: 40px;">Focus on keeping customers.</p>
        </div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="29" data-section="ratio" data-title="Zoom vs WeWork">
      <div class="slide-content">
        <h2 style="text-align: center; margin-bottom: 30px;">Why Unit Economics Determine Destiny</h2>
        <div class="comparison-container">
          <div class="comparison-side left">
            <h3>WeWork</h3>
            <ul>
              <li>High COCA (real estate, buildout)</li>
              <li>Uncertain LTV (high churn)</li>
              <li>Ratio: < 1</li>
              <li style="color: var(--danger); font-weight: 600;">Result: Collapse</li>
            </ul>
          </div>
          <div class="comparison-side right">
            <h3>Zoom</h3>
            <ul>
              <li>Low COCA (viral, free trial)</li>
              <li>High LTV (sticky, expanding)</li>
              <li>Ratio: ~8x</li>
              <li style="color: var(--success); font-weight: 600;">Result: $100B+ company</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- WRAP-UP -->
    <div class="slide slide-visual" data-slide="30" data-section="wrapup" data-title="Theme Complete">
      <div class="slide-content">
        <h2 style="text-align: center;">Theme 4 Complete!</h2>
        <div style="text-align: center; margin-top: 40px;">
          <svg width="300" height="300" viewBox="0 0 300 300" style="margin: 0 auto;">
            <circle cx="150" cy="150" r="130" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="20"/>
            <circle cx="150" cy="150" r="130" fill="none" stroke="var(--theme-color)" stroke-width="20"
                    stroke-dasharray="272 544" stroke-dashoffset="136" stroke-linecap="round"/>
            <text x="150" y="140" text-anchor="middle" fill="var(--text-primary)" font-size="16" font-family="Montserrat">Theme 4</text>
            <text x="150" y="170" text-anchor="middle" fill="var(--theme-color)" font-size="20" font-weight="700" font-family="Montserrat">COMPLETE</text>
          </svg>
        </div>
        <p style="text-align: center; margin-top: 30px; font-size: 1.5rem; color: var(--text-secondary);">
          "How do you make money?" <span style="color: var(--success);">‚úì</span>
        </p>
        <div style="display: flex; justify-content: center; gap: 20px; margin-top: 30px;">
          <span style="color: var(--success);">‚úì Pricing</span>
          <span style="color: var(--success);">‚úì LTV</span>
          <span style="color: var(--success);">‚úì COCA</span>
          <span style="color: var(--success);">‚úì Unit Economics</span>
        </div>
      </div>
    </div>

    <div class="slide slide-list" data-slide="31" data-section="wrapup" data-title="Remember">
      <div class="slide-content">
        <h2>Remember</h2>
        <ul>
          <li><strong>LTV</strong> = value of a customer (profit, not revenue)</li>
          <li><strong>COCA</strong> = cost to acquire a customer (include ALL costs)</li>
          <li><strong>LTV/COCA > 3</strong> for a healthy business</li>
          <li><strong>Retention</strong> is usually the biggest lever</li>
        </ul>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="32" data-section="wrapup" data-title="Before Next Week">
      <div class="slide-content">
        <h2>Before Next Week</h2>
        <div style="max-width: 700px; margin-top: 40px;">
          <div class="homework-item">
            <span class="homework-icon">üßÆ</span>
            <span class="homework-text">Complete LTV calculation (with documented assumptions)</span>
          </div>
          <div class="homework-item">
            <span class="homework-icon">üí∞</span>
            <span class="homework-text">Full COCA breakdown (don't forget founder time!)</span>
          </div>
          <div class="homework-item">
            <span class="homework-icon">üìä</span>
            <span class="homework-text">If ratio < 3: Create improvement plan</span>
          </div>
          <div class="homework-item">
            <span class="homework-icon">üìñ</span>
            <span class="homework-text">Read: DE Chapters 20-23 (Testing & MVBP)</span>
          </div>
        </div>
      </div>
    </div>

    <div class="slide slide-two-part" data-slide="33" data-section="wrapup" data-title="Next Week">
      <div class="slide-content">
        <p class="primary">Next Week: Testing & MVBP</p>
        <p class="secondary">What do you still need to prove?<br>What's your Minimum Viable Business Product?</p>
        <div style="margin-top: 50px; padding: 20px 30px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; display: inline-block;">
          <span style="color: #ef4444; font-weight: 600;">Theme 5: How do you design and build?</span>
        </div>
      </div>
    </div>

    <!-- APPENDIX SLIDES -->
    <div class="slide slide-visual" data-slide="34" data-section="appendix" data-title="LTV Deep Dive" data-appendix="true">
      <div class="slide-content">
        <h2 style="margin-bottom: 1rem;">LTV Deep Dive</h2>
        <p class="tertiary" style="margin-bottom: 1.5rem;">Industry benchmarks and calculation nuances</p>
        <div class="ltv-breakdown">
          <div class="ltv-factor">
            <h4>SaaS ARPU</h4>
            <div class="range">$20-500/mo</div>
            <p>SMB: $20-100<br>Mid-market: $100-500<br>Enterprise: $500+</p>
          </div>
          <div class="ltv-factor">
            <h4>Gross Margin</h4>
            <div class="range">60-85%</div>
            <p>Pure software: 80%+<br>With support: 70-80%<br>Services: 40-60%</p>
          </div>
          <div class="ltv-factor">
            <h4>Monthly Churn</h4>
            <div class="range">2-10%</div>
            <p>Great: <3%<br>Good: 3-5%<br>Concerning: >5%</p>
          </div>
        </div>
        <div class="formula-display" style="max-width: 600px; margin-top: 1.5rem; padding: 30px;">
          <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 10px;">Advanced Formula (with expansion)</p>
          <p class="formula" style="font-size: 1.3rem;"><span>LTV</span> = (ARPU √ó Margin) √∑ (Churn - Expansion)</p>
        </div>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="35" data-section="appendix" data-title="COCA Channels" data-appendix="true">
      <div class="slide-content">
        <h2 style="margin-bottom: 1rem;">COCA by Channel</h2>
        <p class="tertiary" style="margin-bottom: 1.5rem;">Typical acquisition costs across different channels</p>
        <table class="benchmark-table">
          <thead>
            <tr>
              <th>Channel</th>
              <th>Typical COCA</th>
              <th>Time to Close</th>
              <th>Scalability</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Organic/SEO</td>
              <td>$50-200</td>
              <td>Months</td>
              <td>High</td>
            </tr>
            <tr>
              <td>Content Marketing</td>
              <td>$100-300</td>
              <td>Weeks</td>
              <td>High</td>
            </tr>
            <tr>
              <td>Paid Social</td>
              <td>$200-500</td>
              <td>Days</td>
              <td>Medium</td>
            </tr>
            <tr>
              <td>Google Ads</td>
              <td>$300-800</td>
              <td>Days</td>
              <td>Medium</td>
            </tr>
            <tr>
              <td>Inside Sales</td>
              <td>$500-2000</td>
              <td>Weeks</td>
              <td>Medium</td>
            </tr>
            <tr>
              <td>Enterprise Sales</td>
              <td>$5000+</td>
              <td>Months</td>
              <td>Low</td>
            </tr>
          </tbody>
        </table>
        <p class="caption" style="margin-top: 1rem;">Note: These vary widely by industry and product complexity</p>
      </div>
    </div>

    <div class="slide slide-visual" data-slide="36" data-section="appendix" data-title="Industry Benchmarks" data-appendix="true">
      <div class="slide-content">
        <h2 style="margin-bottom: 1rem;">Industry Benchmarks</h2>
        <p class="tertiary" style="margin-bottom: 1.5rem;">LTV/COCA ratios across business types</p>
        <table class="benchmark-table">
          <thead>
            <tr>
              <th>Business Type</th>
              <th>Target LTV/COCA</th>
              <th>Payback Period</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Consumer SaaS</td>
              <td>3-5x</td>
              <td>< 12 months</td>
            </tr>
            <tr>
              <td>B2B SaaS (SMB)</td>
              <td>3-5x</td>
              <td>12-18 months</td>
            </tr>
            <tr>
              <td>B2B SaaS (Enterprise)</td>
              <td>5-8x</td>
              <td>18-24 months</td>
            </tr>
            <tr>
              <td>E-commerce</td>
              <td>2-3x</td>
              <td>< 6 months</td>
            </tr>
            <tr>
              <td>Marketplace</td>
              <td>4-6x</td>
              <td>Variable</td>
            </tr>
            <tr>
              <td>VC-backed (growth)</td>
              <td>3x minimum</td>
              <td>< 18 months</td>
            </tr>
          </tbody>
        </table>
        <div style="margin-top: 1.5rem; padding: 15px 25px; background: var(--bg-secondary); border-radius: 8px; text-align: center;">
          <span style="color: var(--theme-color); font-weight: 600;">Rule of thumb:</span>
          <span style="color: var(--text-secondary); margin-left: 10px;">LTV/COCA > 3 and Payback < 12 months</span>
        </div>
      </div>
    </div>
  </div>

  <div class="progress-container"><div class="progress-bar" id="progress"></div></div>
  <div class="slide-counter"><span id="current-slide">1</span> / <span id="total-slides">36</span></div>

  <!-- Keyboard hints -->
  <div class="keyboard-hints">
    <span class="hint-key">T</span> Contents
    <span class="hint-key">A</span> Appendix
    <span class="hint-key">S</span> Syllabus
  </div>

  <script src="../shared/presentation.js"></script>
  <script>
    // Custom D3 visualizations for this presentation
    // Hook into slide navigation to trigger animations

    const originalGoToSlide = window.Presentation ? window.Presentation.goToSlide : null;

    function initCustomAnimations() {
      if (!window.Presentation) {
        setTimeout(initCustomAnimations, 100);
        return;
      }

      const baseGoToSlide = window.Presentation.goToSlide;
      window.Presentation.goToSlide = function(index) {
        baseGoToSlide(index);
        handleSlideAnimations(index);
      };

      // Handle initial slide
      handleSlideAnimations(0);
    }

    function handleSlideAnimations(index) {
      const slides = document.querySelectorAll('.slide');
      const slide = slides[index];
      if (!slide) return;

      const slideNum = slide.dataset.slide;

      // Animate retention bars (slide 14)
      if (slideNum === '14') {
        setTimeout(() => {
          const bars = slide.querySelectorAll('.retention-bar');
          bars.forEach(bar => {
            const width = bar.dataset.width;
            bar.style.width = width + '%';
          });
        }, 500);
      }

      // Draw funnel (slide 18)
      if (slideNum === '18') {
        drawFunnel();
      }

      // Draw ratio gauge (slide 26)
      if (slideNum === '26') {
        drawRatioGauge();
      }
    }

    // Draw sales funnel
    function drawFunnel() {
      const container = document.getElementById('funnel-viz');
      if (!container || container.querySelector('svg')) return;

      // Define logical coordinate space
      const width = 600;
      const height = 400;

      const svg = d3.select(container)
        .append('svg')
        .attr('viewBox', `0 0 ${width} ${height}`)
        .attr('preserveAspectRatio', 'xMidYMid meet');

      const stages = [
        { name: 'Leads', value: 100, percent: '100%' },
        { name: 'Qualified', value: 40, percent: '40%' },
        { name: 'Demo/Trial', value: 24, percent: '24%' },
        { name: 'Proposal', value: 12, percent: '12%' },
        { name: 'Closed', value: 6, percent: '6%' }
      ];

      // Proportional calculations
      const maxWidth = width * 0.833;           // Max bar width ~83%
      const stageHeight = height * 0.15;        // Each stage ~15% of height
      const gap = height * 0.0375;              // Gap ~3.75% of height
      const startY = height * 0.075;            // Top padding ~7.5%

      stages.forEach((stage, i) => {
        const stageWidth = (stage.value / 100) * maxWidth;
        const x = (width - stageWidth) / 2;
        const y = startY + i * (stageHeight + gap);

        // Draw stage rectangle
        svg.append('rect')
          .attr('x', x)
          .attr('y', y)
          .attr('width', 0)
          .attr('height', stageHeight)
          .attr('rx', 8)
          .attr('fill', `rgba(245, 158, 11, ${0.3 + (i * 0.15)})`)
          .transition()
          .delay(i * 200)
          .duration(800)
          .attr('width', stageWidth);

        // Stage label
        svg.append('text')
          .attr('x', width / 2)
          .attr('y', y + stageHeight / 2 + 6)
          .attr('text-anchor', 'middle')
          .attr('fill', '#f1f1f1')
          .attr('font-family', 'Montserrat')
          .attr('font-size', '1.1rem')
          .attr('font-weight', '600')
          .attr('opacity', 0)
          .text(`${stage.name} (${stage.percent})`)
          .transition()
          .delay(i * 200 + 400)
          .duration(400)
          .attr('opacity', 1);
      });
    }

    // Draw ratio gauge
    function drawRatioGauge() {
      const container = document.getElementById('ratio-gauge');
      if (!container || container.querySelector('svg')) return;

      // Define logical coordinate space
      const width = 500;
      const height = 300;
      const scale_ = Math.min(width, height);

      const svg = d3.select(container)
        .append('svg')
        .attr('viewBox', `0 0 ${width} ${height}`)
        .attr('preserveAspectRatio', 'xMidYMid meet');

      // Proportional calculations
      const centerX = width * 0.5;
      const centerY = height - height * 0.167;      // Bottom area for gauge
      const radius = scale_ * 0.6;                  // Main arc radius
      const arcThickness = scale_ * 0.133;          // Arc ring thickness
      const labelOffset = scale_ * 0.083;           // Label distance from arc
      const tickInner = scale_ * 0.15;              // Tick start offset from radius
      const tickOuter = scale_ * 0.017;             // Tick extend beyond radius
      const tickTextOffset = scale_ * 0.2;          // Tick label offset

      // Define zones
      const zones = [
        { start: 0, end: 1, label: 'Crisis', color: '#ef4444' },
        { start: 1, end: 2, label: 'Danger', color: '#f97316' },
        { start: 2, end: 3, label: 'Caution', color: '#eab308' },
        { start: 3, end: 5, label: 'Healthy', color: '#22c55e' },
        { start: 5, end: 7, label: 'Strong', color: '#15803d' }
      ];

      // Total range is 0-7, maps to 180 degrees (PI radians)
      const valueScale = d3.scaleLinear().domain([0, 7]).range([Math.PI, 0]);

      // Draw arcs for each zone
      zones.forEach((zone, i) => {
        const arc = d3.arc()
          .innerRadius(radius - arcThickness)
          .outerRadius(radius)
          .startAngle(Math.PI / 2 - valueScale(zone.start))
          .endAngle(Math.PI / 2 - valueScale(zone.end));

        svg.append('path')
          .attr('d', arc)
          .attr('transform', `translate(${centerX}, ${centerY})`)
          .attr('fill', zone.color)
          .attr('opacity', 0)
          .transition()
          .delay(i * 150)
          .duration(500)
          .attr('opacity', 1);

        // Zone label
        const midAngle = (valueScale(zone.start) + valueScale(zone.end)) / 2;
        const labelRadius = radius + labelOffset;
        const labelX = centerX + Math.cos(midAngle) * labelRadius;
        const labelY = centerY - Math.sin(midAngle) * labelRadius;

        svg.append('text')
          .attr('x', labelX)
          .attr('y', labelY)
          .attr('text-anchor', 'middle')
          .attr('fill', zone.color)
          .attr('font-family', 'Montserrat')
          .attr('font-size', '1.1rem')
          .attr('font-weight', '600')
          .attr('opacity', 0)
          .text(zone.label)
          .transition()
          .delay(i * 150 + 300)
          .duration(400)
          .attr('opacity', 1);
      });

      // Tick marks and values
      [0, 1, 2, 3, 5, 7].forEach((val, i) => {
        const angle = valueScale(val);
        const innerPoint = {
          x: centerX + Math.cos(angle) * (radius - tickInner),
          y: centerY - Math.sin(angle) * (radius - tickInner)
        };
        const outerPoint = {
          x: centerX + Math.cos(angle) * (radius + tickOuter),
          y: centerY - Math.sin(angle) * (radius + tickOuter)
        };
        const textPoint = {
          x: centerX + Math.cos(angle) * (radius - tickTextOffset),
          y: centerY - Math.sin(angle) * (radius - tickTextOffset)
        };

        svg.append('line')
          .attr('x1', innerPoint.x)
          .attr('y1', innerPoint.y)
          .attr('x2', outerPoint.x)
          .attr('y2', outerPoint.y)
          .attr('stroke', '#4a4a5a')
          .attr('stroke-width', 2);

        svg.append('text')
          .attr('x', textPoint.x)
          .attr('y', textPoint.y + 5)
          .attr('text-anchor', 'middle')
          .attr('fill', '#a0a0a0')
          .attr('font-family', 'Montserrat')
          .attr('font-size', '1.25rem')
          .text(val + 'x');
      });

      // Target indicator
      svg.append('text')
        .attr('x', centerX)
        .attr('y', centerY + height * 0.067)
        .attr('text-anchor', 'middle')
        .attr('fill', '#f1f1f1')
        .attr('font-family', 'Montserrat')
        .attr('font-size', '1rem')
        .text('Target: 3x or higher');
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', initCustomAnimations);
  </script>
</body>
</html>
